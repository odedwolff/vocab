<!DOCTYPE html>
<html>
	
	
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		
		{% load static %}
		<!-- script src="{% static "my_app/example.jpg" %}" alt="My image"/> -->
		<link rel="stylesheet" href="{% static "vocab/style.css" %}"/>
	</head>
	<body>
	
	
	<!--
		<div class="panel1">
			
			
			<div id="load languages">
				load Languages
				
				<button id="loadLangButton">submit
				
				</button>
			</div>
				
			
		</div>
		
		
		<div class="panel1">
			
			
			<div id="load categories">
				load categories
				
				<button id="btnLoadCategories">submit
				
				</button>
			</div>
				
		</div>
		
		
		<div class="panel1">
			
		</div>
		
		
		<div id=divRegisterUser class="panel1">
			register user
			<div id="newUser">
				user name
				<input type="text" id="newUserText" />
				password
				<input type="text" id="newUserPassWordText" />
			</div>	
			<button id=btnAddUser>submit</button>
		</div>
		
		
		
		<div id=divLoggedUser class="panel1" >
			logged on User: <div  id=divLoggedUserName></div>
			<button id=btnLogOff>log off</button>
		</div>
		
		<div id=divFileBrowser class="panel1" >
			<input type="file" style="display: none" id="inFile" />
			<button id=btnBrowsFiles>Open File Dialog</button>	
		</div>
		
			
			
		-->
		
		<!--**********************************************************-->
		
		<div id="divTopBar" style="display: flex; justify-content: flex-end">
			<label id="labelLoggedUser"></label>
			<button id="btnSwitchUser">switchUser</button>
		</div>
		
		
		<div id="divPageSwitchLog">
			<button id="btnLogIn">log in</button>
			<button id="btnRegister">register new user</button>
		</div>
		
		<div id="divPageLogOn">
			<div id=divLogIn class="panel1">
				log user on
				<div id="divLogCred">	
					<input type="text" id="logUesrText" value="user name"/>
					<input type="text" id="logPassText" value="password"/>
				</div>	
				<button id=btnLogOn>submit</button>
			</div>
		</div>
		
		<div id="divPageRegister">
			<div id=divRegisterUser class="panel1">
				register user
				<div id="newUser">
					<input type="text" id="newUserText" value="user name"/>
					<input type="text" id="newUserPassWordText" value="password"/>
				</div>	
				<button id=btnAddUser>submit</button>
			</div>
		</div>
		
		<div id="divPageSwitchAction">
			<button id="btnPractice">practice</button>
			<button id="btnEdit">edit</button>
		</div>
		
		
		<div id="divPagePracticeSetup">
			<div id="divLangListNextQSrc">
				language source 
				<select name="languagesNextQSrc" id="langListNextQSrc">
						
				</select>
			</div>
			<div id=divNextQCats>
				<button id="btnVisibilityCatsNextQ">+-</button>
				<fieldset id="fieldSetNextQCats">  
					<legend>categories</legend>  
							<!-- <input type="checkbox" name="favorite_pet" value="Cats" >Cats<br> -->   		
					<br>  
				</fieldset> 
			</div>
			<div id="divLangListNextQTrg">
				language target
				<select name="languagesNextQTrg" id="langListNextQTrg">
								
				</select>
			</div>
		</div>

		
		<div id="divPageShowQandA">
			<div id=divQuestion>
				<div id=divNextQ class="panel1" >
					<button id=btnNextQ>next question</button>
				</div>
				<textarea id=textQuestion rows="1" cols="50" readonly></textarea>
			</div>	
			
			<div id=divAnswer>
				<!--TODO- consider multiple answers/translations (maybe change 
				height dynamically?)-->
				<!--<button id=btnLoadNextQuesiton>load next question</button> -->
				<button id=btnShowAnswer>show answer</button>
				<div id=divAnswer>
					<textarea id=textAnswer rows="4" cols="50" readonly>answer place holder</textarea>
					<div id="wrapper">
						<label for="answer_radio">Did you know any of the answers?</label>
						<p>
							<input type="radio" name="correct_answer" value=1 checked>Yes</input>
						</p>
						<p>
							<input type="radio" name="correct_answer" value=0>No</input>
						</p>
					</div>
				</div>
				<button id=btnSendCorrct>send</button>	
			</div>
			<button id=btnChangePracticeSetup>change practice setup</button>
		</div>
		
		
		<div id="divPageSwitchEditAction">
			<button id="btnAddLanguage">add language</button>
			<button id="btnAddCategory">add category</button>
			<button id="btnAddTranslation">add translation</button>
			<button id="btnAddTranslationsFromFile">load dict file</button>
		</div>
		
		
		<div id="divPageInsertLanguage">
			<input type="text" id="languageInput" value="newLanguageName"/>
			<button id="submitLanguage">submit	
			</button>
		</div>

		
		<div id="divPageAddCats">
			<input type="text" id="textInputcategories" value="newCategory" />
			<button id="submitInsertCategory">submit
			</button>
			<input type="checkbox" id="checkBoxCatIdPrivate">private<br>
		</div>
		
		
		<!--  use for either choosing 1 or 2 language. for former, hide 2nd list-->
		<div id="divPageSelectLangEdit">
			<div id="divLangListEdit1">
				language source 
				<select name="languages" id="langListEdit1">
					
				</select>
			</div>
			
			<div id="divLangListEdit2">
				language target 
				<select name="languagesTarget" id="langListEdit2">
					
				</select>
			</div>
		</div>

		
		<div id="divPageAddTrxPair">
			<div id="newExpression">		
				<input type="text" id="newExpressionText" value="new word source"/>
				<label for="inSrcWeight">weight(min 0.0, max 1.0)</label>
				<input type="number" id="inSrcWeight" name="inSrcWeight"
						min="0" max="1" step="0.05" value="0.5"/>
				<div>
					<button id="btnVisibilityCatsSrc">+-</button>
				</div>
				<div id=divSrcCats>
					<fieldset id="fieldSetSrcCats">  
						<legend>categories</legend>  
						<!-- <input type="checkbox" name="favorite_pet" value="Cats" >Cats<br> -->   
						<br>  
					</fieldset> 
				</div>
			</div>
			
			<div id="newExpressionTarget">
				<input type="text" id="newExpressionTargetText" value="new word target"/>
				<label for="inTrgWeight">weight(min 0.0, max 1.0)</label>
				<input type="number" id="inTrgWeight" name="inTrgWeight"
					min="0" max="1" step="0.05" value="0.5"/>
				<div>
					<button id="btnVisibilityCatsTrg">+-</button>
				</div>
				<div id=divTrgCats>
					<fieldset id="fieldSetTrgCats">  
						<legend>categories</legend>  
						<!-- <input type="checkbox" name="favorite_pet" value="Cats" >Cats<br> -->   
						<br>  
					</fieldset> 
				</div>
				<!--<button id=submitExpression>submit single</button>-->
				<button id=submitExpressionWTrx>submit full</button>
			</div>
		</div>

		
		
		
		<!--
		<div id=divTest class="panel1" >
			<button id=btnTest>Test</button>	
		</div>
		-->
		
			
		
		<script>
			
			
			//TODO- get this info from configuration on runtime 
			var HOST = "http://localhost:8000";
			var INPUT_GRP_SRC_EXP = "inputGroupSrcExp";
			var INPUT_GRP_TRG_EXP = "inputGroupTrgExp";
			var INPUT_TRP_NEXT_Q = "inputGroupNextQ"
			/**
			todo - each language should probably have its own categries, a category should be a subset of a language (consider 
			rename simply to "subsest" or simlirly )
			**/
			
			
			
			
			var loggedOnUserName=null;
			
			
			var loadedLists = {
				languages: null, 
				categories: null
			}
			
			var currentSelections = {
				languageEdit1:null, 
				languageEdit2: null,
				category: null,
				languageNextQSourcce:null, 
				languageNextQTarget:null
			}
			
			var currentQuestion = {
				expId:null,
				targetLanguage:null
			}
			
			
			function debugQuick(msg){
				console.log()
				console.log("--DEBUG--" + msg);
				//alert(msg);
			}
			
			
			
			function pageSwitchLoginReg(){
				hideAllPages();
				$("#divPageSwitchLog").show();
			}
			function pageSwitchLogin(){
				hideAllPages();
				$("#divPageLogOn").show();
			}
			function pageSwitchRegister(){
				hideAllPages();
				$("#divPageRegister").show();
			}
			function pageSwitchPracticeEdit(){
				hideAllPages();
				$("#divPageSwitchAction").show();
			}
			function pageSwitchPracticeSetup(){
				hideAllPages();
				$("#divPagePracticeSetup").show();
			}
			function pageSwitchShowQuesiton(){
				hideAllPages();
				$("#divPageShowQandA").show();
				$("#divAnswer").hide();	
			}
			function pageSwitchShowAnswer(){
				hideAllPages();
				$("#divPageShowQandA").show();
				$("#divAnswer").show();	
			}
			function pageSwitchEditCasesSwitch(){
				hideAllPages();
				$("#divPageSwitchEditAction").show();
			}
			function pageSwitchInsertLanguage(){
				hideAllPages();
				$("#divPageInsertLanguage").show();
			}
			function insertCategory(){
				hideAllPages();
				$("#divPageAddCats").show();
			}
			
			function choolseEditLanguage(full){
				hideAllPages();
				$("#divPageSelectLangEdit").show();
			}
			
			
			function getStarted(){
				sendGetLoginInfo(
					function(data){
						if(data.isLogged){
							//setPanelLoggedOn(data.username);
							pageSwitchPracticeEdit();
							loggedOnUserName=data.username;
							$("#labelLoggedUser").text(data.username);
							$("#btnSwitchUser").show();
							
						}else{
							//setPanelLoggedOff();
							pageSwitchLoginReg();
							loggedOnUserName=null;
							$("#labelLoggedUser").text("");
							$("#btnSwitchUser").hide();
						}
					}
				);
				loadCategories();
				loadLanguages();
			}
			
			function hideAllPages(){
				$("#divPageSwitchLog").hide();
				$("#divPageLogOn").hide();
				$("#divPageRegister").hide();
				$("#divPageSwitchAction").hide();
				$("#divPagePracticeSetup").hide();
				$("#divPageShowQandA").hide();
				$("#divPageSwitchEditAction").hide();
				$("#divPageInsertLanguage").hide();
				$("#divPageAddCats").hide();
				$("#divPageSelectLangEdit").hide();
				$("#divPageAddTrxPair").hide();
			}

			
			
			
			
			
			
			
			
			//true inidicated visible and vice verca 
			var visStatus = {
				srcCats:true, 
				trgCats:true,
				nextQCats:true
			}
			
			function toggleVis(elmId, statusHandle){
				if(visStatus[statusHandle])
				{
					$("#" + elmId).hide();
					visStatus[statusHandle] = false;
					
				}
				else
				{
					$("#" + elmId).show();
					visStatus[statusHandle] = true;
				}
			}
			
			
			/*
			PAGE_SWITCH_LOG_ON_REG = "pageSwitchLogOnReg"
			pages =  {};
			pages[PAGE_SWITCH_LOG_ON_REG]={
				function show(){
				
				}
			}
			*/
			
			
			
			/**
			sensds request to server to add a new language 
			**/
			function submmitLanguage(){
				langStr = $("#languageInput").val();
				//validate new language input
				if(!langStr || langStr===""){
					debugQuick("empty or null language value");
					return;
				}
				
				var post_data = {
					'csrfmiddlewaretoken':"{{ csrf_token }}", 
					'lang': langStr
				}
				
				$.ajax({
				  url: HOST + '/vocab/add-language',
				  
				  type:'POST',
				  data:post_data,
				  success:function(data){
					//console.log(data);
					debugQuick(data);
					
				  },
				  error:function(error){
					//console.log(error);
					debugQuick(error.responseText);
				  }
				});
			
			}
			
			
			function addNewUser(){
				var userName = $("#newUserText").val();
				if(!userName || userName===""){
					debugQuick("empty or null userName value");
					return;
				}
				var password = $("#newUserPassWordText").val();
				
				
				var post_data = {
					'csrfmiddlewaretoken':"{{ csrf_token }}", 
					'userName': userName,
					'password': password
				}
				
				$.ajax({
				  
				  url:HOST + '/vocab/register-user',
				  type:'POST',
				  data:post_data,
				  success:function(data){
					//console.log(data);
					debugQuick(data);
					if(data.success){
						setPanelLoggedOn(userName);
					}
					
				  },
				  error:function(error){
					//console.log(error);
					debugQuick(error.responseText);
				  }
				});
			
			}
			
			
			
			
			
			
			function sendLogOn(){
				//TODO - add verficiations for username and password 
				userName=$("#logUesrText").val();
				password=$("#logPassText").val();
				var post_data = {
					'csrfmiddlewaretoken':"{{ csrf_token }}", 
					'userName': userName,
					'password': password
				}
				
				$.ajax({
				  
				  url:HOST + '/vocab/log-user-on',
				  type:'POST',
				  data:post_data,
				  success:function(data){
					//console.log(data);
					debugQuick(data);
					if(data.success){
						setPanelLoggedOn(userName);
						loggedOnUserName=username;
					}else{
						alert("log in failed");
						setPanelLoggedOff();
					}
					
				  },
				  error:function(error){
					//console.log(error);
					debugQuick(error.responseText);
				  }
				});
			
			}
			
			
			/**
			sends a request to server to load all languages, than populates all the languages recived in the reply and populates them 
			in lists of available languages 
			**/
			
			function loadLanguages(){
				var post_data = {
					'csrfmiddlewaretoken':"{{ csrf_token }}"
				}
				
				$.ajax({
				  
				  url:HOST + '/vocab/load-languages',
				  type:'POST',
				  data:post_data,
				  success:function(data){
					populateLanguagesListBox(data.loadedLangs);
				  },
				  error:function(error){
					debugQuick(error.responseText);
				  }
				});
			
			}
			
			
			/**
				populate languages in lanuages lists 
			**/
			function populateLanguagesListBox(languages){
				
				lngLists= [$("#langListEdit1"),$("#langListEdit2"),$("#langListNextQSrc"), $("#langListNextQTrg")]
				for(i=0; i<lngLists.length; i++){
					lngLists[i].empty();
				}
				
				currentSelections.languageEdit1 = null;
				currentSelections.languageEdit2 = null;
				for(i = 0; i < languages.length; i++){
					var newLelm = "<option value='" + languages[i].id + "'>" + languages[i].lang + "</option>";
					for(j=0; j <lngLists.length; j++){
						lngLists[j].append(newLelm);
					}
				}
				currentSelections.languageEdit1 = null;
			}
			
			
			/**
			sends new expression to server to be saved 
			**/
			function submitExpression(){
				newExpreesion = $("#newExpressionText").val();
				if (currentSelections.languageEdit1 == null || newExpreesion == null || newExpreesion == ""){
					debugQuick("please make sure that epxresson is not empty and langaue is selected");
					return;
				}
				
				var post_data = {
					'csrfmiddlewaretoken':"{{ csrf_token }}", 
					'expression': newExpreesion, 
					'languageID' : currentSelections.languageEdit1
				}
				
				$.ajax({
				 
				 url:HOST + '/vocab/add-expression', 
				  type:'POST',
				  data:post_data,
				  success:function(data){
					debugQuick(data);
					
				  },
				  error:function(error){
					debugQuick(error.responseText);
				  }
				});
			
			}
			 
			
			/**
			sends a requet for logged on user info form current browser
			**/
			function sendGetLoginInfo(loggedOnInfoCallBack){
				url = HOST + '/vocab/get-logon-status';
				
				var post_data = {
					'csrfmiddlewaretoken':"{{ csrf_token }}"
				}
				
				$.ajax({
				  url: url,
				  type:'POST',
				  data:post_data,
				  /**
				  success:function(data){
					debugQuick(data);
					
				  },**/
				  success:loggedOnInfoCallBack,
				  error:function(error){
					debugQuick(error.responseText);
				  }
				});
			}
			
			
			/**
			submits a pair of expressions that make a translation to server to be saved 
			**/
			
			function submitExpressionFull(){
				var newExpreesion = $("#newExpressionText").val();
				var newExpressionTarget = $("#newExpressionTargetText").val();
				if (currentSelections.languageEdit1 == null || newExpreesion == null || newExpreesion == "" ||
				currentSelections.languageEdit2 == null || newExpressionTarget == null || newExpressionTarget == ""
				){
					debugQuick("please make sure that epxresson is not empty and langaue is selected for both source and target");
					return;
				}
				var weight1=document.getElementById("inSrcWeight").value;
				var weight2=document.getElementById("inTrgWeight").value;
				var cats1 = listSelectedCats("inputGroupSrcExp");
				var cats2 = listSelectedCats("inputGroupTrgExp");
				
				var post_data = {
					'csrfmiddlewaretoken':"{{ csrf_token }}", 
					'expression1': newExpreesion, 
					'languageID1' : currentSelections.languageEdit1,
					'weight1' : weight1, 
					'cats1' : cats1, 
					'expression2': newExpressionTarget, 
					'languageID2' : currentSelections.languageEdit2,
					'weight2' : weight2,
					'cats2' : cats2
				}
				$.ajax({
				  url:HOST + '/vocab/add-expressions-full',
				  type:'POST',
				  data:post_data,
				  success:function(data){
					//console.log(data);
					debugQuick(data);
					
				  },
				  error:function(error){
					//console.log(error);
					debugQuick(error.responseText);
				  }
				});
			}
			
			
			/**
			set panel to given logged user
			**/
			function setPanelLoggedOn(userName){
				$("#divLoggedUser").show();
				$("#divLoggedUserName").append(userName);
				$("#divRegisterUser").hide();
				$("#divLogIn").hide();
			}
			
			/**
			set panel to no logged user
			**/
			
			function setPanelLoggedOff(){
				$("#divLoggedUser").hide();
				$("#divLoggedUserName").empty();
				$("#divRegisterUser").show();
				$("#newUserText").val("");
				$("#newUserPassWordText").val("");
				$("#divLogIn").show();
				$("#logUesrText").val("");
				$("#logPassText").val("");
			}
			
			/**
				get logged on Info from server and update pannels according to result
			**/
			function obtainLogOnInfo (){
				var callBack = function handleRsult(data){
					debugQuick(data);
					if(data.isLogged){
						setPanelLoggedOn(data.username);
						loggedOnUserName=data.username;
					}else{
						setPanelLoggedOff();
					}
				}
				sendGetLoginInfo(callBack);
			}
			
			/**
			send request to log user off
			**/
			function sendLogOff(){
				
				var post_data = {
					'csrfmiddlewaretoken':"{{ csrf_token }}", 
				}
				
				$.ajax({
				  url:HOST + '/vocab/log-user-off',
				  type:'POST',
				  data:post_data,
				  success:function(data){
					debugQuick(data);
					setPanelLoggedOff();
					loggedOnUserName=null;
				  },
				  error:function(error){
					debugQuick(error.responseText);
				  }
				});
			
			}
			
			/**
			sensds request to server insert a new category 
			**/
			function insertCategory(){
				newCat = $("#textInputcategories").val();
				//validate new category input
				if(!newCat || newCat===""){
					debugQuick("empty or null category value");
					return;
				}
				
				//checkBoxCatIdPrivate
				isPrivate=$('#checkBoxCatIdPrivate').prop('checked')
				
				var post_data = {
					'csrfmiddlewaretoken':"{{ csrf_token }}", 
					'cat': newCat, 
					'isPublic':!isPrivate
				}
				
				$.ajax({
				  url: HOST + '/vocab/add-cat',
				  
				  type:'POST',
				  data:post_data,
				  success:function(data){
					//console.log(data);
					debugQuick(data);
					loadCategories();
				  },
				  error:function(error){
					//console.log(error);
					debugQuick(error.responseText);
				  }
				});
			
			}
			
			
			function loadCategories(){
				/**
				loads all categories from server
				**/
				
				
				
				var post_data = {
					'csrfmiddlewaretoken':"{{ csrf_token }}"
				}
				
				$.ajax({
				  url: HOST + '/vocab/load-cats',
				  type:'POST',
				  data:post_data,
				  success:function(data){
					debugQuick(data);
					handleLoadedCats(data);
				  },
				  error:function(error){
					debugQuick(error.responseText);
				  }
				});
			}
			
			
			function handleLoadedCats(catsData)
			{
				/*
				populateCats(catsData, $("#fieldSetSrcCats"), INPUT_GRP_SRC_EXP);
				populateCats(catsData, $("#fieldSetTrgCats"), INPUT_GRP_TRG_EXP);
				populateCats(catsData, $("#fieldSetNextQCats"), INPUT_TRP_NEXT_Q);
				*/
				populateCats(catsData.catListUser, $("#fieldSetSrcCats"), INPUT_GRP_SRC_EXP);
				populateCats(catsData.catListUser, $("#fieldSetTrgCats"), INPUT_GRP_TRG_EXP);
				populateCats(catsData.loadedCatsAll, $("#fieldSetNextQCats"), INPUT_TRP_NEXT_Q);
				

			}
			
			function populateCats(catsData, domElmContainer, groupName){
				var catStr, catId, newDomElmStr
				//catsList = catsData.loadedCats;
				catsList = catsData;
				$(domElmContainer).empty();
				for(var i = 0; i < catsList.length; i++)
				{
					catStr= catsList[i]["cat"];
					catId= catsList[i]["id"];
					newDomElmStr = 
					"<input type='checkbox' name= '" + groupName + "' value= '" + catId +  "'>" + catStr + "<br>"
					$(domElmContainer).append(newDomElmStr)
				}
			}
			
			function listSelectedCats(catsGroupName){
				var checkboxes = document.getElementsByName(catsGroupName);  
				var listOut = [];
				var val;
				for(var i = 0; i < checkboxes.length; i++)  
				{  
					if(checkboxes[i].checked)
					{
						val = checkboxes[i].value;  
						console.log("checked cat:" + val);
						listOut.push(parseInt(val));
						//listOut.push(val);
					}		
				} 
				return listOut;
			}
			
			
			function clickTest1(){
				listSelectedCats("fieldSetSrcCats");
			
			}
			
			
			function readSingleFile(e)
			{
				var file = e.target.files[0];
				if (!file) 
				{
					console.log("event target didnt contain valid file. e.target= " + e.target);
					return;
				}
				var reader = new FileReader();
				reader.onload = function(e) 
					{
						var contents = e.target.result;
						handFileContents(contents);
					};
				reader.readAsText(file);
			}
			
			
			function handFileContents(contents){
				var dataUpLoad = JSON.parse(contents);
				uploadTranslatioinsBatch(dataUpLoad);
			}
			
			function uploadTranslatioinsBatch(uploadDataObj){
				url = HOST + '/vocab/upload-translations-batch';
				var post_data = { 
					'transInfo':uploadDataObj, 
				}
				
				$.ajax({
				  url: url,
				  type:'POST',
				  data:JSON.stringify(post_data),
				  contentType: 'application/json; charset=utf-8',
				  dataType: 'json',
				  async: false,
				  success:function()
					{(console.log("uploadDataObj succeed"))},
				  error:function(error){
					debugQuick(error.responseText);
				  }
				});
			}
			
			
			
			function testSendObjects(){
				url = HOST + '/vocab/test-read-objects';
				var post_data = {
					//'csrfmiddlewaretoken':"{{ csrf_token }}", 
					'k1':45, 
					'k2':"string content", 
					'k3':{"k11":"v11", "k12":"v12"}  
				}
				
				jsonData=JSON.stringify(post_data);
				
				
				$.ajax({
				  url: url,
				  type:'POST',
				  data:jsonData,
				  contentType: 'application/json; charset=utf-8',
				  dataType: 'json',
				  async: false,	  
				  success:function()
					{(console.log("transaction succeeded"))},
				  error:function(error){
					debugQuick(error.responseText);
				  }
				});
			
			}
			
			function sendNextQReuest(){
				console.log("entering sendNextQReuest()")
				url = HOST + '/vocab/next-question';
				cats = listSelectedCats("inputGroupNextQ");
				
				if (currentSelections.languageNextQSourcce == null ||
					currentSelections.languageNextQTarget == null){
						alert("please make sure source and target languages are selected");
						return;
					}
				
				if (cats==null){
					cats==[];
				}
				
				var post_data = {
					'srcLang': currentSelections.languageNextQSourcce  ,
					'trgLang': currentSelections.languageNextQTarget  ,
					'cats': cats 
				}
				
				
				$.ajax({
				  url: url,
				  type:'POST',
				  data:post_data,
				  success:handleNextQResponse,
				  error:function(error){
					debugQuick(error.responseText);
				  }
				});
				
				currentQuestion.targetLanguage=currentSelections.languageNextQTarget
			}	
			
			
			
			function handleNextQResponse(res){
				if(res == null){
					$("#textQuestion").val("no matching words for selected search parameters")
					return;
				}
				console.log("NextQ Resoponse:");
				console.log("(expression id, exp string) =" + res.expStr + ","+res.expId);
				$("#textQuestion").val(res.expStr)
				currentQuestion.expId=res.expId;
				sendLoadTranslations();
			}
			
			
			
			function sendUpdateCorrect(){
				//correctFlg = $("input:radio[name ='managerelradio']:checked").val() == 1;
				correctNum=$("input:radio[name ='correct_answer']:checked").val();
				console.log("selecte val from radio=" + correctNum)
				
				postData={
					srcExpId:currentQuestion.expId,
					targetLang:currentQuestion.targetLanguage,
					correct: correctNum
				}
				
				$.ajax({
				  url: HOST + '/vocab/handle-answer',
				  
				  type:'POST',
				  data:postData,
				  success:function(data){
					//console.log(data);
					debugQuick(data);
					
				  },
				  error:function(error){
					//console.log(error);
					debugQuick(error.responseText);
				  }
				});
			}
			
			
			function sendLoadTranslations(){
				debugQuick("sending reqest for translations")
				postData= 
				{
					expId: currentQuestion.expId, 
					trgLang: currentQuestion.targetLanguage
				}
				$.ajax({
				  url: HOST + '/vocab/load-translations',
				  
				  type:'POST',
				  data:postData,
				  success:handleTrxResponse,
				  error:function(error){
					//console.log(error);
					debugQuick(error.responseText);
				  }
				});
			
			}
			
			function handleTrxResponse(data){
				$("#textAnswer").val(data);
				debugQuick(data);
			}
			
			
			
			/*
			function loadNextQuestion(){
				data={
					'srcLang':currentSelections.language,
					'trgLang':currentSelections.languageNextQTarget,
					'cats': listSelectedCats
				} 
			}
			*/
			
			/*
			srcLang=request.POST["srcLang"]	
					trgLang=request.POST["trgLang"]
					cats=request.POST.getlist("cats[]")
			*/

			
		
			/**
			set up liseterners 
			**/
			$("#submitLanguage").click(
				submmitLanguage
			);
			
			$("#loadLangButton").click(
				loadLanguages
			);
			
			$("#btnAddUser").click(
				addNewUser
			);
			
			$("#btnLogOff").click(
				sendLogOff
			);
			
			
			$("#submitInsertCategory").click(
				insertCategory
			);
			
			$("#btnLoadCategories").click(
				loadCategories
			);
			
			$("#btnTest1").click(
				clickTest1
			);
			
			
			$("#btnTest").click(
				testSendObjects
			);
			
			$("#btnNextQ").click(
				sendNextQReuest
			);
			
			
			
			
			
			
			
			
			$("#btnVisibilityCatsSrc").click(
				function()
				{
					toggleVis("divSrcCats", "srcCats");
				}
			);
			
			$("#btnVisibilityCatsTrg").click(
				function()
				{
					toggleVis("divTrgCats", "trgCats");
				}
			);
			
			$("#btnVisibilityCatsNextQ").click(
				function()
				{
					toggleVis("divNextQCats", "nextQCats");
				}
			);
			
			
			
			$("#btnBrowsFiles").on("click", function() {
                //$("input").trigger("click");
				$("#inFile").trigger("click");
            });
			
			$("#inFile").change(function(e)
			//$("#inFile").select(function(e)
			{
				var fileName = $(this).val();
				//alert(fileName)
				//alert(e.target);
				readSingleFile(e);
				$(this).val("");
				$(this).val("");
			}
			);
			
			
			
			
			$("#langListEdit1").change(
				function(){
					//var selectedLanguageID = $(this).find('option:selected').text();
					var selectedLanguageID = $(this).find('option:selected').val();
					currentSelections.languageEdit1 = selectedLanguageID;
				}
			);
			
			$("#languagesListTarget").change(
				function(){
					//var selectedLanguageID = $(this).find('option:selected').text();
					var selectedLanguageID = $(this).find('option:selected').val();
					currentSelections.languageEdit2 = selectedLanguageID;
				}
			);
			
			
			$("#divLangListNextQSrc").change(
				function(){
					//var selectedLanguageID = $(this).find('option:selected').text();
					var selectedLanguageID = $(this).find('option:selected').val();
					currentSelections.languageNextQSourcce = selectedLanguageID;
				}
			);
			
			
			$("#langListNextQTrg").change(
				function(){
					//var selectedLanguageID = $(this).find('option:selected').text();
					var selectedLanguageID = $(this).find('option:selected').val();
					currentSelections.languageNextQTarget = selectedLanguageID;
				}
			);
			
			
				
			
			
			$("#submitExpression").click(submitExpression);
			$("#submitExpressionWTrx").click(submitExpressionFull);
			//$("#btnLoggedInUserInfo").click(sendGetLoginInfo);
			$("#btnLoggedInUserInfo").click(obtainLogOnInfo);
			$("#btnLogOn").click(sendLogOn);
			$("#textAnswer").hide();
			$("#btnShowAnswer").click(function(){$("#textAnswer").show();});
			$("#btnSendCorrct").click(sendUpdateCorrect);

			$("#btnPractice").click(pageSwitchPracticeSetup);
			$("#btnEdit").click(pageSwitchEditCasesSwitch);
			

			
			
			
			//when page first opens, get the logged on info from server 
			///obtainLogOnInfo();
			
			getStarted();
			
		</script>
	</body>
</html>
